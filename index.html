<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè• –£—á–µ—Ç –ø—Ä–æ–¥–∞–∂ –≤—Ä–∞—á–µ–π</title>
    <style>
        :root {
            --color-bg-primary: #fcfcf9;
            --color-bg-secondary: #fffffe;
            --color-text-primary: #13343b;
            --color-text-secondary: #626c7c;
            --color-primary: #21808d;
            --color-primary-hover: #1d7480;
            --color-border: rgba(94, 82, 64, 0.2);
            --color-success: #21808d;
            --color-error: #c0152f;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--color-bg-primary);
            color: var(--color-text-primary);
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: var(--color-bg-secondary);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            color: var(--color-primary);
        }

        .user-info {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .salon-badge {
            background: var(--color-primary);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 500;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
        }

        .btn-secondary {
            background: rgba(94, 82, 64, 0.12);
            color: var(--color-text-primary);
        }

        .btn-secondary:hover {
            background: rgba(94, 82, 64, 0.2);
        }

        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 80vh;
        }

        .login-box {
            background: var(--color-bg-secondary);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            width: 100%;
            max-width: 400px;
        }

        .login-box h2 {
            text-align: center;
            color: var(--color-primary);
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--color-text-primary);
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            font-size: 14px;
            background: var(--color-bg-primary);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .card {
            background: var(--color-bg-secondary);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .card h3 {
            color: var(--color-primary);
            margin-bottom: 15px;
            font-size: 18px;
        }

        .search-box {
            position: relative;
            margin-bottom: 15px;
        }

        .doctor-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            background: var(--color-bg-primary);
            margin-top: 5px;
        }

        .doctor-item {
            padding: 10px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .doctor-item:hover {
            background: rgba(33, 128, 141, 0.1);
        }

        .selected-doctor {
            background: rgba(33, 128, 141, 0.15);
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 500;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .product-btn {
            padding: 15px;
            border: 2px solid var(--color-border);
            border-radius: 8px;
            background: var(--color-bg-primary);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .product-btn:hover {
            border-color: var(--color-primary);
            background: rgba(33, 128, 141, 0.05);
        }

        .product-btn.selected {
            border-color: var(--color-primary);
            background: rgba(33, 128, 141, 0.15);
            font-weight: 500;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--color-border);
        }

        th {
            background: rgba(33, 128, 141, 0.1);
            color: var(--color-primary);
            font-weight: 600;
        }

        tr:hover {
            background: rgba(33, 128, 141, 0.05);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .hidden {
            display: none !important;
        }

        .error-message {
            background: rgba(192, 21, 47, 0.1);
            color: var(--color-error);
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid var(--color-error);
        }

        .success-message {
            background: rgba(33, 128, 141, 0.1);
            color: var(--color-success);
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid var(--color-success);
        }

        @media (max-width: 768px) {
            .product-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ -->
        <div id="loginScreen" class="login-screen">
            <div class="login-box">
                <h2>üè• –í—Ä–∞—á–∏ –∏ –ü—Ä–æ–¥–∞–∂–∏</h2>
                <div class="form-group">
                    <label>–ú–∞–≥–∞–∑–∏–Ω:</label>
                    <select id="loginUsername" class="form-control">
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –º–∞–≥–∞–∑–∏–Ω --</option>
                        <option value="siema">–°–∏–µ–º–∞</option>
                        <option value="barakat">–ë–∞—Ä–∞–∫–∞—Ç</option>
                        <option value="citymall">–°–∏—Ç–∏ –ú–æ–ª–ª</option>
                        <option value="aini">–ê–π–Ω–∏</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="loginPassword" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                </div>
                <button onclick="login()" class="btn btn-primary" style="width: 100%;">–í—Ö–æ–¥</button>
                <div id="loginError" class="error-message hidden"></div>
            </div>
        </div>

        <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
        <div id="mainApp" class="hidden">
            <div class="header">
                <h1>üè• –í—Ä–∞—á–∏ –∏ –ü—Ä–æ–¥–∞–∂–∏</h1>
                <div class="user-info">
                    <div class="salon-badge" id="currentSalon"></div>
                    <button onclick="logout()" class="btn btn-secondary">–í—ã—Ö–æ–¥</button>
                </div>
            </div>

            <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–¥–∞–∂–∏ -->
            <div class="card">
                <h3>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–¥–∞–∂–∏</h3>
                <div class="form-group">
                    <label>–ü–æ–∏—Å–∫ –≤—Ä–∞—á–∞ (–∫–æ–¥ –∏–ª–∏ —Ñ–∞–º–∏–ª–∏—è):</label>
                    <input type="text" id="searchDoctor" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–ª–∏ —Ñ–∞–º–∏–ª–∏—é">
                    <div id="doctorResults" class="doctor-list hidden"></div>
                </div>
                <div id="selectedDoctorInfo" class="selected-doctor hidden"></div>
                <div class="form-group">
                    <label>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä:</label>
                    <div class="product-grid" id="productGrid"></div>
                </div>
                <div class="action-buttons">
                    <button onclick="recordSale()" class="btn btn-primary">‚úì –ó–∞–ø–∏—Å–∞—Ç—å –ø—Ä–æ–¥–∞–∂—É</button>
                    <button onclick="clearForm()" class="btn btn-secondary">‚úï –û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
                <div id="saleMessage" class="hidden"></div>
            </div>

            <!-- –ü—Ä–æ–¥–∞–∂–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è -->
            <div class="card">
                <h3>–ü—Ä–æ–¥–∞–∂–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è</h3>
                <div class="table-container">
                    <table id="todaySalesTable">
                        <thead>
                            <tr>
                                <th>–í—Ä–∞—á</th>
                                <th>–ö–æ–¥</th>
                                <th>–¢–æ–≤–∞—Ä</th>
                                <th>–í—Ä–µ–º—è</th>
                            </tr>
                        </thead>
                        <tbody id="todaySalesBody">
                            <tr><td colspan="4" style="text-align: center;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- –î–æ–±–∞–≤–∏—Ç—å –≤—Ä–∞—á–∞ -->
            <div class="card">
                <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –≤—Ä–∞—á–∞</h3>
                <div class="form-group">
                    <label>–ö–æ–¥ –≤—Ä–∞—á–∞:</label>
                    <input type="text" id="newDoctorCode" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 101">
                </div>
                <div class="form-group">
                    <label>–§–∞–º–∏–ª–∏—è –≤—Ä–∞—á–∞:</label>
                    <input type="text" id="newDoctorName" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω–æ–≤">
                </div>
                <button onclick="addDoctor()" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –≤—Ä–∞—á–∞</button>
                <div id="doctorMessage" class="hidden"></div>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ –≤—Ä–∞—á–µ–π -->
            <div class="card">
                <h3>–°–ø–∏—Å–æ–∫ –≤—Ä–∞—á–µ–π</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>–ö–æ–¥</th>
                                <th>–§–∞–º–∏–ª–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="doctorListBody">
                            <tr><td colspan="2" style="text-align: center;">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://mvjiqysmcclvceswfqwv.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im12amlxeXNtY2NsdmNlc3dmcXd2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE0MDUyOTYsImV4cCI6MjA3Njk4MTI5Nn0.FoRyIZ9E4M2ZwEE8Kh4hDdkBDLuhyqRut7VEKG4uQkk';

        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –∏—Ö –¥–∞–Ω–Ω—ã–µ
        const USERS = {
            siema: { password: '1111', displayName: '–°–∏–µ–º–∞' },
            barakat: { password: '1111', displayName: '–ë–∞—Ä–∞–∫–∞—Ç' },
            citymall: { password: '1111', displayName: '–°–∏—Ç–∏ –ú–æ–ª–ª' },
            aini: { password: '1111', displayName: '–ê–π–Ω–∏' }
        };

        const PRODUCTS = [
            { id: 'shoes', name: 'üëü –û–±—É–≤—å' },
            { id: 'insoles', name: 'üìç –°—Ç–µ–ª—å–∫–∏' },
            { id: 'accessories', name: 'üéí –ê–∫—Å–µ—Å—Å—É–∞—Ä—ã' },
            { id: 'supinator', name: 'ü¶∂ –°—É–ø–∏–Ω–∞—Ç–æ—Ä' },
            { id: 'brace', name: 'üè• –ë—Ä–µ–π—Å' },
            { id: 'socks', name: 'üß¶ –ß—É–ª–∫–∏' },
            { id: 'freika', name: 'üîß –®–∏–Ω–∞ —Ñ—Ä–µ–π–∫–∞' }
        ];

        let currentUser = null;
        let doctors = [];
        let selectedDoctor = null;
        let selectedProduct = null;
        let sales = [];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            checkLogin();
            renderProducts();
            setupSearchListener();
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–¥–∞
        function checkLogin() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = savedUser;
                showMainApp();
            }
        }

        // –í—Ö–æ–¥
        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');

            if (!username) {
                errorDiv.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –º–∞–≥–∞–∑–∏–Ω';
                errorDiv.classList.remove('hidden');
                return;
            }

            if (USERS[username] && USERS[username].password === password) {
                currentUser = username;
                localStorage.setItem('currentUser', username);
                errorDiv.classList.add('hidden');
                showMainApp();
            } else {
                errorDiv.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å';
                errorDiv.classList.remove('hidden');
            }
        }

        // –í—ã—Ö–æ–¥
        function logout() {
            localStorage.removeItem('currentUser');
            currentUser = null;
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('loginPassword').value = '';
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        function showMainApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('currentSalon').textContent = USERS[currentUser].displayName;
            loadDoctors();
            loadTodaySales();
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
        function renderProducts() {
            const grid = document.getElementById('productGrid');
            grid.innerHTML = '';
            PRODUCTS.forEach(product => {
                const btn = document.createElement('div');
                btn.className = 'product-btn';
                btn.textContent = product.name;
                btn.onclick = () => selectProduct(product.id);
                btn.dataset.productId = product.id;
                grid.appendChild(btn);
            });
        }

        // –í—ã–±–æ—Ä —Ç–æ–≤–∞—Ä–∞
        function selectProduct(productId) {
            selectedProduct = productId;
            document.querySelectorAll('.product-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector(`[data-product-id="${productId}"]`).classList.add('selected');
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–∏—Å–∫–∞ –≤—Ä–∞—á–∞
        function setupSearchListener() {
            const searchInput = document.getElementById('searchDoctor');
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase().trim();
                if (query.length === 0) {
                    document.getElementById('doctorResults').classList.add('hidden');
                    return;
                }
                
                const filtered = doctors.filter(doc => 
                    doc.code.toLowerCase().includes(query) || 
                    doc.name.toLowerCase().includes(query)
                );
                
                displayDoctorResults(filtered);
            });
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ –≤—Ä–∞—á–µ–π
        function displayDoctorResults(filtered) {
            const resultsDiv = document.getElementById('doctorResults');
            if (filtered.length === 0) {
                resultsDiv.classList.add('hidden');
                return;
            }

            resultsDiv.innerHTML = '';
            filtered.forEach(doc => {
                const item = document.createElement('div');
                item.className = 'doctor-item';
                item.textContent = `${doc.code} - ${doc.name}`;
                item.onclick = () => selectDoctor(doc);
                resultsDiv.appendChild(item);
            });
            resultsDiv.classList.remove('hidden');
        }

        // –í—ã–±–æ—Ä –≤—Ä–∞—á–∞
        function selectDoctor(doctor) {
            selectedDoctor = doctor;
            document.getElementById('selectedDoctorInfo').textContent = 
                `–í—ã–±—Ä–∞–Ω–Ω—ã–π –≤—Ä–∞—á: ${doctor.name} (–∫–æ–¥: ${doctor.code})`;
            document.getElementById('selectedDoctorInfo').classList.remove('hidden');
            document.getElementById('doctorResults').classList.add('hidden');
            document.getElementById('searchDoctor').value = '';
        }

        // –ó–∞–ø–∏—Å—å –ø—Ä–æ–¥–∞–∂–∏
        async function recordSale() {
            const messageDiv = document.getElementById('saleMessage');
            
            if (!selectedDoctor) {
                messageDiv.className = 'error-message';
                messageDiv.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–∞—á–∞';
                messageDiv.classList.remove('hidden');
                return;
            }

            if (!selectedProduct) {
                messageDiv.className = 'error-message';
                messageDiv.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä';
                messageDiv.classList.remove('hidden');
                return;
            }

            const sale = {
                salon: currentUser,
                doctorCode: selectedDoctor.code,
                doctorName: selectedDoctor.name,
                product: PRODUCTS.find(p => p.id === selectedProduct).name,
                timestamp: new Date().toISOString()
            };

            try {
                await saveSaleToSupabase(sale);
                messageDiv.className = 'success-message';
                messageDiv.textContent = '‚úì –ü—Ä–æ–¥–∞–∂–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–∏—Å–∞–Ω–∞!';
                messageDiv.classList.remove('hidden');
                
                clearForm();
                loadTodaySales();
                
                setTimeout(() => {
                    messageDiv.classList.add('hidden');
                }, 3000);
            } catch (error) {
                messageDiv.className = 'error-message';
                messageDiv.textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏: ' + error.message;
                messageDiv.classList.remove('hidden');
            }
        }

        // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
        function clearForm() {
            selectedDoctor = null;
            selectedProduct = null;
            document.getElementById('searchDoctor').value = '';
            document.getElementById('selectedDoctorInfo').classList.add('hidden');
            document.querySelectorAll('.product-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–∞—á–∞
        async function addDoctor() {
            const code = document.getElementById('newDoctorCode').value.trim();
            const name = document.getElementById('newDoctorName').value.trim();
            const messageDiv = document.getElementById('doctorMessage');

            if (!code || !name) {
                messageDiv.className = 'error-message';
                messageDiv.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è';
                messageDiv.classList.remove('hidden');
                return;
            }

            if (doctors.some(d => d.code === code)) {
                messageDiv.className = 'error-message';
                messageDiv.textContent = '–í—Ä–∞—á —Å —Ç–∞–∫–∏–º –∫–æ–¥–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';
                messageDiv.classList.remove('hidden');
                return;
            }

            const newDoctor = { code, name };

            try {
                await saveDoctorToSupabase(newDoctor);
                await loadDoctors();
                messageDiv.className = 'success-message';
                messageDiv.textContent = '‚úì –í—Ä–∞—á —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!';
                messageDiv.classList.remove('hidden');
                
                document.getElementById('newDoctorCode').value = '';
                document.getElementById('newDoctorName').value = '';
                renderDoctorList();
                
                setTimeout(() => {
                    messageDiv.classList.add('hidden');
                }, 3000);
            } catch (error) {
                messageDiv.className = 'error-message';
                messageDiv.textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏: ' + error.message;
                messageDiv.classList.remove('hidden');
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Ä–∞—á–µ–π
        async function loadDoctors() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/doctors?select=*`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });

                const data = await response.json();
                doctors = data || [];
                renderDoctorList();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Ä–∞—á–µ–π:', error);
                doctors = [];
                renderDoctorList();
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–ø–∏—Å–∫–∞ –≤—Ä–∞—á–µ–π
        function renderDoctorList() {
            const tbody = document.getElementById('doctorListBody');
            if (doctors.length === 0) {
                tbody.innerHTML = '<tr><td colspan="2" style="text-align: center;">–ù–µ—Ç –≤—Ä–∞—á–µ–π</td></tr>';
                return;
            }

            tbody.innerHTML = '';
            doctors.forEach(doc => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${doc.code}</td><td>${doc.name}</td>`;
                tbody.appendChild(tr);
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–¥–∞–∂ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
        async function loadTodaySales() {
            try {
                const today = new Date().toISOString().split('T')[0];
                const response = await fetch(`${SUPABASE_URL}/rest/v1/sales?select=*,doctors(code,name)&sale_date=gte.${today}T00:00:00&sale_date=lte.${today}T23:59:59`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });

                const data = await response.json();
                sales = data || [];
                renderTodaySales();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–¥–∞–∂:', error);
                sales = [];
                renderTodaySales();
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø—Ä–æ–¥–∞–∂ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
        function renderTodaySales() {
            const tbody = document.getElementById('todaySalesBody');

            if (sales.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>';
                return;
            }

            tbody.innerHTML = '';
            sales.reverse().forEach(sale => {
                const tr = document.createElement('tr');
                const time = new Date(sale.sale_date).toLocaleTimeString('ru-RU', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                tr.innerHTML = `
                    <td>${sale.doctors?.name || 'N/A'}</td>
                    <td>${sale.doctors?.code || 'N/A'}</td>
                    <td>${sale.product_type}</td>
                    <td>${time}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Ä–∞—á–∞ –≤ Supabase
        async function saveDoctorToSupabase(doctor) {
            await fetch(`${SUPABASE_URL}/rest/v1/doctors`, {
                method: 'POST',
                headers: {
                    'apikey': SUPABASE_ANON_KEY,
                    'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                    'Content-Type': 'application/json',
                    'Prefer': 'return=minimal'
                },
                body: JSON.stringify({
                    code: doctor.code,
                    name: doctor.name
                })
            });
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏ –≤ Supabase
        async function saveSaleToSupabase(sale) {
            const doctorId = doctors.find(d => d.code === sale.doctorCode)?.id;
            
            if (!doctorId) {
                throw new Error('–í—Ä–∞—á –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö');
            }

            await fetch(`${SUPABASE_URL}/rest/v1/sales`, {
                method: 'POST',
                headers: {
                    'apikey': SUPABASE_ANON_KEY,
                    'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                    'Content-Type': 'application/json',
                    'Prefer': 'return=minimal'
                },
                body: JSON.stringify({
                    doctor_id: doctorId,
                    product_type: sale.product
                })
            });
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>

